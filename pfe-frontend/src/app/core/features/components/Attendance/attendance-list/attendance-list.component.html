<!-- src/app/features/attendance/attendance-list/attendance-list.component.html -->
<div class="p-4">
  <div class="card shadow-lg rounded-lg p-4">
    <h3 class="text-2xl font-semibold mb-4">Attendance Sheet</h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      <div>
        <label class="block text-sm font-medium mb-1" for="dateFilter">Date</label>
        <input
          id="dateFilter"
          type="date"
          pInputText
          [(ngModel)]="selectedDate"
          (ngModelChange)="loadAttendances()"
          class="w-full"
        />
      </div>

      <div>
        <label class="block text-sm font-medium mb-1" for="userFilter">Filter by Employee ID</label>
        <input
          id="userFilter"
          type="text"
          pInputText
          placeholder="Enter ID"
          [(ngModel)]="selectedUserId"
          (ngModelChange)="loadAttendances()"
          class="w-full"
        />
      </div>
    </div>

    <p-table [value]="attendances" [loading]="isLoading" *ngIf="!errorMessage">
      <ng-template pTemplate="header">
        <tr>
          <th>ID</th>
          <th>Employee</th>
          <th>Department</th>
          <th>Date/Time</th>
          <th>Type</th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-att>
        <tr>
          <td>{{ att.uid }}</td>
          <td>{{ att.employe_name }}</td>
          <td>{{ att.departement_name }}</td>
          <td>{{ att.timestamp | date:'dd/MM/yyyy HH:mm:ss' }}</td>
          <td>
            <p-badge
              [value]="getTypeLabel(att.type)"
              [severity]="att.type === 0 ? 'info' : att.type === 1 ? 'success' : 'warning'">
            </p-badge>
          </td>
          <td>
            <button pButton 
                    icon="pi pi-pencil" 
                    class="p-button-rounded p-button-text p-button-sm"
                    (click)="openEditDialog(att)"
                    pTooltip="Edit attendance type">
            </button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="text-center p-4">No records found for this date.</td>
        </tr>
      </ng-template>
    </p-table>

    <div *ngIf="errorMessage" class="mt-4 p-4 bg-red-100 text-red-800 rounded">
      {{ errorMessage }}
    </div>
  </div>
</div>

<!-- Edit Dialog -->
<p-dialog 
  [(visible)]="showEditDialog" 
  [style]="{width: '450px',height:'300px'}" 
  header="Edit Attendance Type" 
  [modal]="true"
  [draggable]="false"
  [resizable]="false">
  <div class="p-fluid">
    <div class="field">
      <label for="attendanceType">Attendance Type</label>
      <p-dropdown 
        id="attendanceType"
        [(ngModel)]="selectedAttendanceType"
        [options]="attendanceTypes"
        optionLabel="label"
        optionValue="value"
        [showClear]="true"
        [filter]="false"
        [style]="{'width':'100%'}"
        placeholder="Select a type">
        <ng-template pTemplate="selectedItem">
          <div *ngIf="selectedAttendanceType !== null">
            {{ getTypeLabel(selectedAttendanceType.toString()) }}
          </div>
        </ng-template>
        <ng-template let-option pTemplate="item">
          <div>{{ option.label }}</div>
        </ng-template>
      </p-dropdown>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <button pButton 
            pRipple 
            label="Cancel" 
            icon="pi pi-times" 
            class="p-button-text" 
            (click)="showEditDialog = false">
    </button>
    <button pButton 
            pRipple 
            label="Save" 
            icon="pi pi-check" 
            class="p-button-text" 
            (click)="saveAttendanceType()"
            [disabled]="!selectedAttendanceType==null">
    </button>
  </ng-template>
</p-dialog>
